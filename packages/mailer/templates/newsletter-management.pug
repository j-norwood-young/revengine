extends layout.pug
block content
    h1 RevEngine Newsletter Management Report - #{moment().format("D MMMM YYYY")}
    table#someID.report_table.some-class
        tr
            th(rowspan=2) List
            th(rowspan=2) Subs
            th(colspan=4) Last 7 days
            th(colspan=4) Last 30 days
        tr
            th Joins
            th Unsubs
            th Growth
            th Chng

            th Joins
            th Unsubs
            th Growth
            th Chng
        each list in lists
            if list.active
                if list.subscribers.length > 10
                    tr
                        td
                            a(href="#"+list._id)= list.name
                        td= numberFormat.format(list.total_active)

                        td= numberFormat.format(list.active_last_week_count)
                        td= numberFormat.format(list.unsubscribed_last_week_count)
                        td= numberFormat.format(list.last_week_delta / (list.total_active - list.last_week_delta) * 100)
                            | %
                        td
                            if list.last_week_delta > list.prev_week_delta
                                .change.green &#9650; 
                            if list.last_week_delta < list.prev_week_delta
                                .change.red &#9660;

                        td= numberFormat.format(list.active_last_month_count)
                        td= numberFormat.format(list.unsubscribed_last_month_count)
                        td= numberFormat.format(list.last_month_delta / (list.total_active - list.last_month_delta) * 100)
                            | %
                        td
                            if list.last_month_delta > list.prev_month_delta
                                .change.green &#9650; 
                            if list.last_month_delta < list.prev_month_delta
                                .change.red &#9660;
    p * Only lists with 50 or more active subscribers added in last 60 days displayed.
    each list in lists
        h2(id=list._id) #{list.name} #{numberFormat.format(list.total_active)}
        table
            tr.cards
                td
                    .card
                        .card-title
                           h2 1 Day
                        .card-body
                            .article
                                .article-count.big_num= numberFormat.format(list.active_last_day_count)
                                .article-title Joined
                            .article
                                .article-count.big_num= numberFormat.format(list.unsubscribed_last_day_count)
                                .article-title Unsubscribed
                            .article
                                .article-count.big_num= numberFormat.format(list.last_day_delta)
                                .article-title Nett
                            .article
                                .article-count.big_num= numberFormat.format(list.prev_day_delta)
                                .article-title Previous period nett
                            .article
                                .article-count.big_num= numberFormat.format(list.last_day_delta / (list.total_active - list.last_day_delta) * 100)
                                    | %
                                .article-title Growth
                            .article
                                if list.last_day_delta > list.prev_day_delta
                                    .change.green &#9650;  
                                if list.last_day_delta < list.prev_day_delta
                                    .change.red &#9660;
                                if list.last_day_delta
                                    .article-count.big_num
                                        if list.last_day_delta < list.prev_day_delta
                                            | -
                                        = numberFormat.format(Math.abs(list.roc_day) * 100)
                                        | %
                                else
                                    | NA
                                .article-title Rate of Change
                td
                    .card
                        .card-title
                           h2 7 Days 
                        .card-body
                            .article
                                .article-count.big_num= numberFormat.format(list.active_last_week_count)
                                .article-title Joined
                            .article
                                .article-count.big_num= numberFormat.format(list.unsubscribed_last_week_count)
                                .article-title Unsubscribed
                            .article
                                .article-count.big_num= numberFormat.format(list.last_week_delta)
                                .article-title Nett
                            .article
                                .article-count.big_num= numberFormat.format(list.prev_week_delta)
                                .article-title Previous period nett
                            .article
                                .article-count.big_num= numberFormat.format(list.last_week_delta / (list.total_active - list.last_week_delta) * 100)
                                    | %
                                .article-title Growth
                            .article
                                if list.last_week_delta > list.prev_week_delta
                                    .change.green &#9650; 
                                if list.last_week_delta < list.prev_week_delta
                                    .change.red &#9660;
                                if list.last_week_delta
                                    .article-count.big_num
                                        if list.last_week_delta < list.prev_week_delta
                                            | -
                                        = numberFormat.format(Math.abs(list.roc_week) * 100)
                                        | %
                                else
                                    | NA
                                .article-title Rate of Change
                td
                    .card
                        .card-title
                            h2 30 Days 
                        .card-body
                            .article
                                .article-count.big_num= numberFormat.format(list.active_last_month_count)
                                .article-title Joined
                            .article
                                .article-count.big_num= numberFormat.format(list.unsubscribed_last_month_count)
                                .article-title Unsubscribed
                            .article
                                .article-count.big_num= numberFormat.format(list.last_month_delta)
                                .article-title Nett
                            .article
                                .article-count.big_num= numberFormat.format(list.prev_month_delta)
                                .article-title Previous period nett
                            .article
                                .article-count.big_num= numberFormat.format(list.last_month_delta / (list.total_active - list.last_month_delta) * 100)
                                    | %
                                .article-title Growth
                            .article
                                if list.last_month_delta > list.prev_month_delta
                                    .change.green &#9650; 
                                if list.last_month_delta < list.prev_month_delta
                                    .change.red &#9660;
                                if list.last_month_delta
                                    .article-count.big_num
                                        if list.last_month_delta < list.prev_month_delta
                                            | -
                                        = numberFormat.format(Math.abs(list.roc_month) * 100)
                                        | %
                                else
                                    | NA
                                .article-title Rate of Change
    