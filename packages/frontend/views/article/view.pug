extends ../layout

block content
    .container
        p Sentiment: #{sentiment.sentiment} (#{sentiment.sentiment_score})
        h1= article.title
        h5= article.author 
        p Published #{moment(article.date_published).format("YYYY-MM-DD HH:mm:ss")} | Last Modified #{moment(article.date_modified).format("YYYY-MM-DD HH:mm:ss")}
        each section in article.sections 
            .badge.badge-primary.mr-1= section
        each tag in article.tags 
            .badge.badge-secondary.mr-1= tag
        a(href=homepage + "/article/" + article.urlid target="_blank")
            .fa.fa-link
        canvas#articleHits
        h5.mt-4 Total Hits: #{formatNumber(article.hits.reduce((acc, val) => acc + val.count ,0))}
        hr
        .flex-horiz.mb-4
            h3.mt-4= article.excerpt
            if (article.img_medium)
                img.ml-4(src=article.img_medium)
        .article-content !{article.content.replace(/\n/g, '<br/>')}
block scripts
    script.
        document.addEventListener("DOMContentLoaded", async (event) => {
            const beam = new Beam();
            let article_data = await beam.get("/article/hits/#{article._id}")
            const charts = new Charts();
            charts.drawHistogram({
                element: "#articleHits", 
                data: article_data, 
                label: "Hits",
                key_label: "date",
                value_label: "count",
                unit: "day",
                type: "bar"
            });
        })