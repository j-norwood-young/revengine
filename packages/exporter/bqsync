#!/bin/sh

mongoexport -d revengine-prod -c woocommerce_subscriptions -o ~/data/woocommerce_subscriptions.csv --type csv --fields id,billing_interval,billing_period,cancelled_email_sent,created_via,customer_id,customer_ip_address,customer_note,customer_user_agent,date_completed,date_created,date_modified,date_paid,payment_method,products.0.name,products.0.total,schedule_next_payment,schedule_start,status,suspension_count,total,meta_data.0.value.utmSource,meta_data.0.value.utmMedium,meta_data.0.value.utmCampaign,meta_data.0.value.utmTerm,meta_data.0.value.deviceType

/usr/bin/bq load --replace --skip_leading_rows=1 --allow_quoted_newlines=1 --source_format=CSV revengine_prod.woocommerce_subscriptions ~/data/woocommerce_subscriptions.csv id:INT64,billing_interval:INT64,billing_period:STRING,cancelled_email_sent:BOOL,created_via:STRING,customer_id:INT64,customer_ip_address:STRING,customer_note:STRING,customer_user_agent:STRING,date_completed:TIMESTAMP,date_created:TIMESTAMP,date_modified:TIMESTAMP,date_paid:TIMESTAMP,payment_method:STRING,product_name:STRING,product_total:FLOAT64,schedule_next_payment:TIMESTAMP,schedule_start:TIMESTAMP,status:STRING,suspension_count:INT64,total:FLOAT64,utmSource:STRING,utmMedium:STRING,utmCampaign:STRING,utmTerm:STRING,deviceType:STRING

mongoexport -d revengine-prod -c woocommerce_orders -o ~/data/woocommerce_orders.csv --type csv --fields id,customer_id,customer_ip_address,customer_user_agent,date_completed,date_created,date_modified,date_paid,order_key,payment_method,products.0.name,total

/usr/bin/bq load --replace --skip_leading_rows=1 --allow_quoted_newlines=1 --source_format=CSV revengine_prod.woocommerce_orders ~/data/woocommerce_orders.csv id:INT64,customer_id:INT64,customer_ip_address:STRING,customer_user_agent:STRING,date_completed:TIMESTAMP,date_created:TIMESTAMP,date_modified:TIMESTAMP,date_paid:TIMESTAMP,order_key:STRING,payment_method:STRING,product_name:STRING,total:FLOAT64

mongoexport -d revengine-prod -c readers -o ~/data/readers.csv --type csv --fields id,current_login,description,display_name,first_name,last_login,last_name,last_update,nickname,paying_customer,user_email,user_login,user_nicename,user_registered,user_url,wc_last_active,wp_capabilities.reader,wp_capabilities.author,wp_capabilities.administrator

/usr/bin/bq load --replace --skip_leading_rows=1 --allow_quoted_newlines=1 --source_format=CSV revengine_prod.readers ~/data/readers.csv id:INT64,current_login:TIMESTAMP,description:STRING,display_name:STRING,first_name:STRING,last_login:TIMESTAMP,last_name:STRING,last_update:TIMESTAMP,nickname:STRING,paying_customer:BOOL,user_email:STRING,user_login:STRING,user_nicename:STRING,user_registered:TIMESTAMP,user_url:STRING,wc_last_active:TIMESTAMP,wp_capabilities_reader:BOOL,wp_capabilities_author:BOOL,wp_capabilities_administrator:BOOL

mongoexport -d revengine-prod -c woocommerce_memberships -o ~/data/memberships.csv --type csv --fields id,customer_id,status,start_date,end_date,cancelled_date,date_created,date_modified,order.id,order.total,order.date_paid,product.id,product.name,paused_date

/usr/bin/bq load --replace --skip_leading_rows=1 --allow_quoted_newlines=1 --source_format=CSV revengine_prod.woocommerce_memberships ~/data/memberships.csv id:INT64,customer_id:INT64,status:STRING,start_date:TIMESTAMP,end_date:TIMESTAMP,cancelled_date:TIMESTAMP,date_created:TIMESTAMP,date_modified:TIMESTAMP,order_id:INT64,order_total:FLOAT64,order_date_paid:TIMESTAMP,product_id:INT64,product_name:STRING,paused_date:TIMESTAMP
